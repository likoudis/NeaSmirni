<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.all.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>

	<script src="scripts/location.js"></script>
	<script src="scripts/app.js"></script>
	<script src="scripts/i-headers.js"></script>
	<script src="scripts/i-details.js"></script>
	<script src="scripts/i-notes.js"></script>
	<script src="scripts/i-history.js"></script>
	<script src="scripts/i-snap.js"></script>

	<style>
        html .km-wp-light .km-content,
        html .km-wp-light .km-button,
        html .km-wp-light .km-navbar,
        html .km-wp-light .km-detail,
        html .km-wp-light *:not(.k-label) > input:not(.k-input),
        html .km-wp-light .k-dropdown,
        html .km-wp-light *:not(.k-label) > textarea,
        html .km-wp-light *:not(.k-label) > select {
            background: #fff;
        }
    </style>
</head>
<body>
    <!--Welcome-->
	<div id="view-welcome"
        data-role="view"
        data-title="Welcome">
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="view-content">
			<div class="img"></div>
			<div style="text-align:center; margin: 20px">
            	<a id="openHomePage" 
					data-role="button"
					data-bind="visible: isDeviceValid"
					href="#drawer-inspxions">
					Open Inspections
            	</a>
			</div>
			<div style="height:60px">
	        	<a id="logout" data-role="button" data-bind="visible: isDeviceValid"
					data-click="app.logout" >
					Logout
                </a>
			</div>
			<div id="no-host" data-bind="invisible: isDeviceValid" style="height:60px">
				<label for="hostName"> Logged out. Please supply a server address:
					<a style="float:right" id="submitbutton" data-role="button" data-click="app.checkValidDevice">Enter</a>
					<input style="float:right" type="text" id="hostName" data-bind="value: hostName">
				</label>
            </div>
			<div style="display:block; font-size: 0.75em">
				Device ID:
				<span id="loginDeviceId" data-bind="text: deviceId"> </span>
				<span style="float:right;">Version 2014.08.28.1&nbsp;</span>
			</div>
        </div>
	</div>

	<!--Left drawer-->
	<!-- map should not be included here, if it should not respond to swipe -->
	<div data-role="drawer" id="left-drawer" data-position="left"
		data-views="[
		'drawer-inspxions','drawer-filter','drawer-map','drawer-sync','drawer-settings',
		'drawer-snap','drawer-report','drawer-email',
		'inspx-details','inspx-notes', 'inspx-hist', 'drawer-pixurs']"
		style="width: 290px"> 
		<ul data-role="listview" data-type="flat">
			<li data-icon="dct-home">    <a data-transition="none" href="#view-welcome">Home</a></li>
			<li data-icon="dct-headers"> <a data-transition="none" href="#drawer-inspxions?filter=all">All Inspections</a></li>
			<li data-icon="dct-headers"> <a data-transition="none" href="#drawer-inspxions?filter=today">Today's Inspections</a></li>
			<li data-icon="dct-headers"> <a data-transition="none" href="#drawer-inspxions?filter=yesterday">Yesterday's Inspections</a></li>
			<li data-icon="dct-headers"> <a data-transition="none" href="#drawer-inspxions?filter=thisWeek">This Week's Inspections</a></li>
			<li data-icon="dct-headers"> <a data-transition="none" href="#drawer-inspxions?filter=lastWeek">Last Week's Inspections</a></li>
			<!--li data-icon="featured"> <a data-transition="none" href="#drawer-filter">Inspection Filter</a></li -->
			<!--li data-icon="dct-map">    <a data-transition="none" href="#drawer-map"   >Map</a></li!-->
			<li></li>
			<!--<li data-icon="downloads"><a data-transition="none" href="#drawer-sync"    >Synchronize</a></li>-->
			<li data-icon="dct-settings"> <a data-transition="none" href="#drawer-settings" >Settings</a></li>
		</ul>
	</div>
	
	<!--Right drawer 4 inspx lists-->
	<!-- map should not be included here, if it should not respond to swipe -->
	<div data-role="drawer" id="right-drawer0" data-position="right"
		data-views="['drawer-inspxions','drawer-filter']"
		style="width: 200px">
		<ul data-role="listview" data-type="flat">
			<li data-icon="dct-snap">   <a data-transition="none" href="#drawer-snap"    >Snap</a> </li>
			<li data-icon="dct-report"><a data-transition="none" href="#drawer-report"  >Report</a></li>
			<li data-icon="dct-e-mail"><a data-transition="none" href="#drawer-email"   >E-mail</a></li>
		</ul>
	</div>
	
	<!--Right drawer 4 single inspx-->
	<div data-role="drawer" id="right-drawer1" data-position="right"
		data-views="[
		'inspx-details','inspx-notes','drawer-pixurs','drawer-addinspx', 'inspx-hist']"
		style="width: 200px">
		<ul data-role="listview" data-type="inset" >
			<li data-icon="dct-assessment"><a data-transition="none" data-rel="modalview" href="#modal-psfc"  data-role="button">Assessment</a></li>
			<!-- li data-icon="compose">  <a data-transition="none" href="#drawer-addinspx">Add Inspection</a></li!-->
			<li data-icon="dct-details">  <a data-transition="none" href="#inspx-details" >Details</a></li>
			<li data-icon="dct-notes"> <a data-transition="none" href="#inspx-notes"   >Notes</a></li>
			<li data-icon="dct-pictures">   <a data-transition="none" href="#drawer-pixurs">Pictures</a></li>
			<li></li>
			<li data-icon="dct-snap">   <a data-transition="none" href="#drawer-snap"   >Snap</a> </li>
			<li data-icon="dct-report"> <a data-transition="none" href="#drawer-report" >Report</a></li>
			<li data-icon="dct-e-mail"> <a data-transition="none" href="#drawer-email"  >E-mail</a></li>
		</ul>
	</div>
	
	<!--Drawer Layout 4 not-leaf views-->
	<div data-role="layout" data-id="drawer-layout">
		<header data-role="header">
			<div data-role="navbar" id="inspxListViewNavBar">
				<a data-role="button" data-align="left" data-rel="drawer" href="#left-drawer" data-icon="dct-lists">Lists</a>
				<span data-role="view-title"></span>
				<!--a data-role="button" data-align="right" data-rel="drawer" href="#right-drawer0" data-icon="dct-actions">Actions</a!-->
				<a data-role="backbutton" data-icon="dct-back" data-align="right">Back</a>
			</div>
		</header>
	</div>

	<!--Drawer Layout 4 leaf views-->
	<div data-role="layout" data-id="drawer-layout1">
		<header data-role="header">
			<div data-role="navbar" id="inspxData1ViewNavBar">
				<a data-role="button" data-align="left" data-rel="drawer" href="#left-drawer" data-icon="dct-lists">Lists</a>
				<span data-role="view-title"></span>
				<a data-role="button" data-align="right" data-rel="drawer" href="#right-drawer1" data-icon="dct-actions">Actions</a>
				<a data-role="backbutton" data-icon="dct-back" data-align="right">Back</a>
			</div>
		</header>
	</div>

	<!--Drawer Layout 4 leaf views with non-leaf options-->
	<div data-role="layout" data-id="drawer-layout2">
		<header data-role="header">
			<div data-role="navbar" id="inspxData2ViewNavBar">
				<a data-role="button" data-align="left" data-rel="drawer" href="#left-drawer" 
					data-icon="dct-lists">Lists</a>
				<span data-role="view-title"></span>
				<a data-role="backbutton" data-icon="dct-back" data-align="right">Back</a>
			</div>
		</header>
	</div>

	<!--Inspection headers-->
	<div id="drawer-inspxions" data-role="view" data-layout="drawer-layout" data-title="All Inspections"
		data-init="app.mobileListViewFiltering" 
		data-show="app.onInspectionShow">
		<!-- div class="map-search-wrap">
			<button id="map-navigate-home"></button>
			<form onsubmit="return false;">
				<input id="map-address" type="search" placeholder="Address" />
				<input class="map-search" type="submit" value="" />
			</form>
		</div -->
		<div id="headerListScroller" data-role="scroller"
			style="width:100%">
		    <ul id="filterList" class="filterList" data-role="listview">
		    </ul>
        </div>
	</div>
	<script type="text/x-kendo-template" id="inspx-template">
		<div>
			<div class="item-thumb">
				<img class="loading-thumb" src= "#= "data:image/jpg;base64," + ThumbnailBase64 #" >
			</div>
			<div class="item-summary">
				<h3>
					<span class="time">
						#= InspectionDate === null ? 'No date' : new Date(InspectionDate).toDateString() #
					</span>
					<span style="float:right">
						#= PropertyAddress #
					</span>
				</h3>
				<p>No: #= InspectionNo #</p>
				<p>#= InspectionType #</p>
			</div>
		<a class="item-link" href="\#inspx-notes" onclick="return app.setAndReadFor(#=InspectionId #,'#=PropertyAddress #');"
			> &nbsp; &nbsp; &gt; &nbsp;
		</a>
		</div>
	</script>

	<!--Filter-->
	<div data-role="view" data-title="Inspection List Filter" id="drawer-filter" data-layout="drawer-layout" >
		<label>
	        From-date:
 			<input type="date" value="2014-01-22" />
		</label>
		<label>
    	    To-date:
 			<input type="date" value="2014-03-22" />
		</label>
		<label>Inspection Status
			<select  id="dropdown">
				<option value="All">All</option>
				<option value="Pass">Pass</option>
				<option value="Fail">Fail</option>
				<option value="Conditional">Conditional</option>
			</select>
		</label>
		<ul class="filterList" data-role="listview" data-template="inspx-template" data-source="inspxDataList">
		</ul>
    </div>

	<!--Map-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-map" data-title="Map"
		data-init="app.locationService.initLocation"
		data-show="app.locationService.show"
		data-hide="app.locationService.hide"
		data-model="app.locationService.viewModel"
		data-stretch="true">

		<div id="no-map" data-bind="invisible: isGoogleMapsInitialized">
			This view requires internet connection to display the map.
		</div>
		<div>
			<!--div class="map-search-wrap">
				<div>
					<button id="map-navigate-home" class="map-tools-button home" data-bind="click: onNavigateHome"></button>
    				<input id="map-address" type="search" class="map-tools-input" data-bind="value: address" placeholder="Address" />
					<button class="map-tools-button search" data-bind="click: onSearchAddress"></button>
				</div>
			</div-->
			<ul id="listview-permitsToday" 
				data-role="listview"
				data-bind="source: permitsTodayDataSource"
				data-template="location-inspections-template">
			</ul>
			<p id="map-canvas"
				data-bind="visible: isGoogleMapsInitialized">
			</p>
		</div>
	</div>

	<!--Inspection Address List template-->
	<script type="text/x-kendo-tmpl" id="location-inspections-template">
		<div>
			#=address#
			<a 
				data-role="detailbutton" data-icon="dct-mapAdd"
				data-bind="click:onInspectionSelect, invisible:inspectionAddressOnMap">
				<span style="visibility:hidden">#=id#</span>
			</a>
			<a 
				data-role="detailbutton" data-icon="dct-mapRemove"
				data-bind="click:onInspectionSelect, visible:inspectionAddressOnMap">
				<span style="visibility:hidden">#=id#</span>
			</a>
		</div>
	</script>

	<!--Settings-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-settings" data-title="Settings" data-use-native-scrolling="true">
		<form action="javascript:history.back()">
			<ul data-role="listview" data-style="inset" id="settingsListView">
				<li>
					<label>Service host URL: 
						<input type="url" placeholder="http://server:port/service/program(?.....)"
							data-bind="value:serviceHostURL"
							value="http://dctlt063:8000/directit.permitting">
					</label>
                </li>
				<li>
					<label>Service host URL: 
						<input type="url" placeholder="http://server:port/service/program(?.....)"
							data-bind="value:serviceHostURL"
							value="http://dctlt063:8000/directit.permitting">
					</label>
                </li>
				<li>
					<label>Service host URL:</label>
						<input type="url" placeholder="http://server:port/service/program(?.....)"
							data-bind="value:serviceHostURL"
							value="http://dctlt063:8000/directit.permitting">
                </li>
				<li>
					<label>Service host URL: 
						<input type="url" placeholder="http://server:port/service/program(?.....)"
							data-bind="value:serviceHostURL"
							value="http://dctlt063:8000/directit.permitting">
					</label>
                </li>
			
			</ul>
        </form>
	</div>
	
	<!--Assess (pass/fail)-->
	<div data-role="modalview" id="modal-psfc" data-width="400" data-height="430" data-modal="false">
		<div data-role="header">
			<div data-role="navbar">
				<span>Assessment</span>
			</div>
		</div>

		<ul data-role="listview">
			<li style="text-align:center"> Date: today</li>
			<li data-role="button"><span data-icon="dct-pass" >Pass</span></li>
			<li data-role="button"><span data-icon="dct-fail" >Fail</span></li>
			<li data-role="button"><span data-icon="dct-willSee" >Conditional</span></li>
		</ul>

		<div data-role="footer">
			<div data-role="navbar">
				<a id="cancel-login" data-click="app.closeAssessModalView" data-align="right" data-role="button">Cancel</a>
			</div>
		</div>

	</div>
 
	<!--Inspection Details-->
	<div id="inspx-details" data-role="view" data-layout="drawer-layout1" 
		data-show="app.onDetailsShow">
		<ul id="i-detail-section" data-role="listview"
			data-source="app.detailsDataSource"
			data-template="details-template1"
			data-auto-bind="false">
		  </ul>
	</div>
	<script type="text/x-kendo-template" id="details-section-template">
		# if (header !== "History") { #
			<h2>#: header #</h2>
			<ul id="i-detail-list"
				data-role="listview"  data-template="details-template"
				data-bind="source: fields">
			</ul>
		# } else { #
			<a  href="\#inspx-hist">
				<h2> #: header # </h2>
			</a>
		# } #
	</script>
	<script type="text/x-kendo-template" id="details-template">
		<span style="font-weight: bold">#= desc # </span>
		<span style="float:right">#= 
			typeof(ix) !== "function"
				? app.detailsViewModel.detailsDataSource.data()[0][ix] 
				: ix()# </span>
	</script>
	<script type="text/x-kendo-template" id="details-template1">
<h2>Inspection Information</h2>
<p><span>Inspection Date</span>                     <span>#=InspectionId#</span></p>
<p><span>Inspected</span>          <span>#=InspectionDate.toDateString()#</span></p>
<p><span>Assigned To</span>                    <span>#=AssignedInspector#</span></p>
<p><span>Status</span>                          <span>#=InspectionStatus#</span></p>
<p><span>Type</span>                              <span>#=InspectionType#</span></p>
<p><span>Requested</span>             <span>#=RequestDate.toDateString()#</span></p>
<p><span>Number</span>                              <span>#=InspectionNo#</span></p>
<h2>Property Information</h2>
<p><span>Address</span>                          <span>#=PropertyAddress#</span></p>
<p><span>Owner</span>                                      <span>#=Owner#</span></p>
<p><span>Legal Description</span>               <span>#=LegalDescription#</span></p>
<p><span>Rol \#</span>                             <span>#=RollNoDisplay#</span></p>
<h2>Permit Information</h2>
<p><span>Description</span>                    <span>#=PermitDescription#</span></p>
<p><span>Permit Date</span>            <span>#=PermitDate.toDateString()#</span></p>
<p><span>Construction type</span>               <span>#=ConstructionType#</span></p>
<p><span>Permit Id</span>                            <span>#=PermitDocId#</span></p>
<p><span>Permit Number</span>                           <span>#=PermitNo#</span></p>
<p><span>Permit type</span>                           <span>#=PermitType#</span></p>
<p><span>Current use</span>                           <span>#=CurrentUse#</span></p>
<p><span>Intended use</span>                         <span>#=IntendedUse#</span></p>
<p><span>Conditional permit</span><span>#=IsPermitConditional?"Yes":"No"#</span></p>
<p><span>Permit notes</span>  <span>#=InspectionNotes.length||"No notes"#</span></p>
<h2><a href="\#inspx-hist" style="text-decoration: none" onclick="return app.savePermitDocId()">History</a></h2>
	</script>

	<!--Inspection Notes-->
	<div id="inspx-notes" data-title="Inspection Notes" data-role="view" data-layout="drawer-layout1"
		data-show="app.onNotesShow">
		<div style="text-align:center">
			<p>New Note</p>
			<form style="margin-right: 15px">
				<textarea id="newNoteText"
					style="padding: 3px"></textarea>
			<div data-role="button" data-click="app.onAddNote">Append</div>
			</form>
		</div>
		<div>
			<ul id="i-notes-section" data-role="listview" data-template="notes-template"
				data-source="app.notesDataSource" data-auto-bind="false" data-pull-to-refresh="false">
			</ul>
		</div>
	</div>
	<script type="text/x-kendo-template" id="notes-template">
		<div class="item-summary" style="width:60%">
		<h3 class="time"> #= CreateDate === null ? "No date" : new Date(CreateDate).toDateString()  # </h3>
		<p> #= Note || "&lt;no notes&gt;" # </p>
		</div>
	</script>

	<!--Pictures-->
	<div data-role="view" data-title="Inspection Pictures" id="drawer-pixurs" data-layout="drawer-layout1" data-stretch="true"
		data-show="app.galleryShow">
		<!--ul id="gallery-listview"
			data-role="listview"
			data-source="app.galleryDataSource"
			data-template="pix-list-template" 
			data-click="showDetail">
		</ul-->

		<div data-role="scrollview"
			data-source="app.galleryDataSource"
			data-template="scrollview-template"
			data-content-height="100%"
			data-enable-pager="true"
		>
		</div>
	</div>
	<script type="text/x-kendo-template" id="pix-list-template1">
		<p><img height="400" width="auto" src="#= MobileFileName #"><span class="idetail-d"> #= MobileFileName#   </span></p>
    </script>
	<script type="text/x-kendo-template" id="scrollview-template">
		<div style="width:auto; height:100%; margin-right:auto; margin-left:auto; white-space: initial">
		<img style="display: block; width:auto; margin-right:auto; margin-left:auto" src="#= MobileFileName #">
			#= MobileFileName.replace(/\//g, " ") #
		</div>
    </script>
	<script type="text/x-kendo-template" id="scrollview-template1">
		<div class="image" style="background-image: url(#: MobileFileName #)">
		</div>
    </script>
	<style scoped>
		.image {
			display: block;
			margin: 1em auto;
			height: 400px;
			width: 400px;
			background-size: auto 100%;
		}
	</style>

	<!--Snap-->
	<div id="drawer-snap" data-role="view" data-layout="drawer-layout2"
		data-title="Take Pictures" data-show="app.onSnapShow">
		<div style="margin:5px">
			<div>
				<p>Add a picture to the current inspection </p>
				<a data-role="button" data-click="app.onSnapClick" id="snap-button">
					Snap
				</a>
        	</div>
			<div style="display:inline-block; vertical-align: top; width: 49%">
				<img id="snap-thumb" alt="No picture available"

				style="width:350px; margin: 10px">
				<div id="snap-fname"></div>
			</div>
			<form id="pixur-note-form" style="text-align: center">
				<p>Image Note</p>
				<textarea id="newImgNoteText"></textarea>
				<div data-role="button" data-click="app.onAddImgNote">
					Upload <span id="uploadProgress"></span>
				</div>
			</form>
		</div>
	</div>
	
	<!--Report-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-report"
		data-title="Reports" data-show="app.onReportShow">
		<a data-role="button" href="#"
			style="position: fixed; right:5px; top:65px">
			E-mail
        </a>
		<div data-role="scroller" id="scroller-report" style="width:100%">
		</div>
	</div>

	<!--Email-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-email" data-show="app.onEmailShow">
		<div data-role="scroller">
			<form>
				<ul data-role="listview" data-style="inset">
					<li>
						<label>To:
							<input type="email" style="width:85%; text-align:left" value="someone@domain.ca" />
						</label>
					</li>
					<li>
						<label>Subject:
							<input type="text" style="width:85%; text-align:left" value="Re: Inspection ###########" />
						</label>
					</li>
					<li>
						<label>Message
							<textarea placeholder="Enter your comments here..." 
								rows="10" cols="60" style="width:85%; padding: 3px; border: 1px solid">
                  </textarea>
						</label>
					</li>
					<li>
						<p>Attachment: /storage/sdcard0/My_Inspections/###########.jpg</p>
						<p>Attachment: /storage/sdcard0/My_Inspections/###########.rpt</p>
						<p>Attachment: /storage/sdcard0/My_Inspections/###########.eml</p>
                    </li>
				</ul>
			</form>
		</div>
		<a style="position:fixed; bottom: 40px; right: 30px" data-role="button">
			Submit
        </a>
	</div>
	
	<!--Inspection History-->
	<div id="inspx-hist" data-role="view" data-layout="drawer-layout" data-title="Past Inspections"
		data-show="app.onHistoryShow">
		<!--div class="map-search-wrap">
			<button id="map-navigate-home"></button>
			<form onsubmit="return false;">
				<input id="map-address" type="search" placeholder="Address" />
				<input class="map-search" type="submit" value="" />
			</form>
		</div-->
		<ul class="filterList" data-role="listview" data-template="inspx-template" data-source="app.historyDataSource" data-auto-bind="false">
		</ul>
	</div>

	<!--Add Inspection-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-addinspx" data-title="Add an Inspection">
	</div>
	
	<!--Synchronize-->
	<div data-role="view" data-layout="drawer-layout2" id="drawer-sync" data-title="Synch with Server">
	</div>

	<!-- Status line -->
	<div id="status-line"
		style="position: absolute; bottom:0px; width: 100%;
			background-color:lightBlue;">
	</div>
	
</body>
</html>